#!/bin/bash

# ########################################
# # Environment configuration of MDE4CPP #
# ########################################

# path to MDE4CPP home folder
export MDE4CPP_HOME=$PWD

# path to eclipse home folder including Acceleo plugins
# required for creating the generators
export MDE4CPP_ECLIPSE_HOME=~/<PATH to eclipse_modeling>


# ##################################################
# # configure Gradle tasks and compiling processes #
# ##################################################

# enable parallel execution of Gradle tasks permanently with value 'true', otherwise 'false'
export GRADLE_OPTS=-Dorg.gradle.parallel=true

# configure count of worker for each compile task 
# (if two compiling tasks are performed in parallel, 2 x WORKER processes are executed)
export ORG_GRADLE_PROJECT_WORKER=1

# release version will be compiled with value unequal '0' or if ORG_GRADLE_PROJECT_RELEASE and ORG_GRADLE_PROJECT_DEBUG are undefined
export ORG_GRADLE_PROJECT_RELEASE=1

# debug version will be compiled with value unequal '0' or if ORG_GRADLE_PROJECT_RELEASE and ORG_GRADLE_PROJECT_DEBUG are undefined
export ORG_GRADLE_PROJECT_DEBUG=1

# debug messages of fUML library will be enabled with value '1', this property has no effect on release compiling
export ORG_GRADLE_PROJECT_DEBUG_MESSAGE_FUML=0

# Cross-compilation to Windows configuration
# Read CROSS_COMPILE_WINDOWS from MDE4CPP_Generator.properties
# Always read from file to ensure it matches the current configuration
if [ -f "$MDE4CPP_HOME/MDE4CPP_Generator.properties" ]; then
    CROSS_COMPILE_WINDOWS=$(grep -i "^CROSS_COMPILE_WINDOWS" "$MDE4CPP_HOME/MDE4CPP_Generator.properties" | cut -d'=' -f2 | tr -d ' ' | tr -d '\r')
fi
# Default to false if not found in file
if [ -z "$CROSS_COMPILE_WINDOWS" ]; then
    CROSS_COMPILE_WINDOWS=false
fi
# Set cross-compiler when cross-compilation is enabled
if [ "$CROSS_COMPILE_WINDOWS" = "true" ]; then
    export CC=x86_64-w64-mingw32-gcc
    export CXX=x86_64-w64-mingw32-g++
    # Note: We use regular 'make' even for cross-compilation (x86_64-w64-mingw32-make may not be installed)
    # The important part is that CC and CXX point to the cross-compilers
    export MAKE=make
fi

# update the PATH variable locally to be able to call the executable and scripts from all subfolders
export PATH="$MDE4CPP_HOME/application/bin:$MDE4CPP_HOME/application/tools:$PATH"

# #############################
# # configure LD_LIBRARY_PATH #
# #############################

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PWD/application/bin

# #############################################################################
# # Configure JAVA CLASSPATH                                                  #
# #############################################################################

export CLASSPATH=$MDE4CPP_ECLIPSE_HOME/plugins

# ##############################################################################
# # configure compiler information for include path setting inside cpp eclipse #
# ##############################################################################

export CPP_IDE_EXECUTABLE=$MDE4CPP_ECLIPSE_HOME

# The generators create eclipse cpp projects files including include path.
# Estimated path to compiler includes: ${COMPILER_HOME}/lib/gcc/${COMPILER_DELIVERY_NAME}/${COMPILER_VERSION}/include
# Configuration is only necessary for eclipse use.

# path to compiler home folder
#export COMPILER_HOME=

# delivery name of compiler, only necessary for include path generation for Eclipse Project file
#export COMPILER_DELIVERY_NAME=

# compiler version, only necessary for include path generation for Eclipse Project file
#export COMPILER_VERSION=

cd ./gradlePlugins
gradlew publishMDE4CPPPluginsToMavenLocal

cd $MDE4CPP_HOME
# bash